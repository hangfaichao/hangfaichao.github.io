---
title: Class类文件的结构
date: 2019-09-27 10:39:02
tags: JAVA
category: JVM
---

Java虚拟机不和包括Java在哪的任何语言绑定，它只与“Class文件”这种特定的二进制文件格式所关联，Class文件中包含了Java虚拟机指令集和符号表以及若干其他辅助信息。任何语言都可以将Java虚拟机作为产品交付媒介。Java虚拟机也可以在各种不同的平台上运行。

## Class类文件的结构

了解Class类文件的结构是了解虚拟机的重要基础之一。

Class文件是一组以8位字节为基础单位的二进制流，各个数据项目严格按照顺序紧凑排列在Class文件中，中间没有添加任何分隔符。

Class文件格式采用一种类似C语言结构体的伪结构来存储数据。这种伪结构只有两种数据类型：无符号数和表。

- 无符号数属于基本的数据类型，u1、u2、u4、u8来分别表示1个字节、2个字节、4个字节和8个字节的无符号数。无符号数可以用来描述数字、索引引用、数量值或者按照UTF-8编码构成的字符串值。
- 表是由多个无符号数或者其他表作为数据项构成的复合数据类型。所有表都习惯性的以"_info"结尾。

### 魔数与Class文件的版本

每个Class文件头4个字节（0x0000～0x0003）被称为魔数，值为：0xCAFEBABE，作用是确定这个文件是否为一个能被虚拟机接受的Class文件。

紧接着魔术的4个字节（0x0004～0x0007）存储的是Class文件的版本号，第5、6个字节是次版本号，第7、8个字节是主版本号，JDK1.1之后的每个主版本号向上加1（JDK1.1支持45.0～45.65535）。

### 常量池

主次版本号之后是常量池入口，常量池可以理解为Class文件之中的资源仓库，是占用Class文件空间最大的数据项目之一。

入口（0x0008）：一项u2类型的数据，代表常量池容量计数值。这个容量计数值是从1而不是从0开始的，如0x0016，即十进制的22，代表常量池中含有21项常量。

常量池中主要存放的两大类型常量：字面量和符号引用

- 字面量：如文本字符串、生命为final的常量值等。
- 符号引用：
  - 类和接口的权限定名
  - 字段的名称和描述符
  - 方法的名称和描述符

常量池中的每一项常量都是一个表（共14种），表开始的第一位是一个u1类型的标志位

### 访问标志

紧接着常量池的两个字节表示访问标志，用于识别一些类或者接口层次的访问信息，包括：这个Class是类还是接口；是否定义为public类型；是否定义为abstract类型；如果是类的话，是否被声明为final等。

### 类索引、父类索引与接口索引集合

类索引、父亲类索引都是一个u2类型的数据，类索引用于确定这个类的全限定名，父类索引用于确定这个类的父亲的全限定名。

接口索引集合是一组u2类型的数据的集合，第一项是一u2类型的接口计数器表示索引表的容量。

### 字段表集合

用于描述接口或者类中声明的变量。字段包括类级变量以及实例级变量，但不包括在方法内部声明的局部变量。

（后面有点看不下去了哇...T_T

### 方法表集合

### 属性表集合

## 字节码指令简介

